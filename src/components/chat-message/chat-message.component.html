@if (message().sender === 'ai') {
    @if (parsedContent(); as p) {
    <div class="flex justify-center">
        <div class="bg-stone-700 rounded-lg p-3 sm:p-4 max-w-[90%] sm:max-w-lg shadow-lg text-center">
            <div class="text-stone-200" [innerHTML]="p.intro"></div>
            @if (message().imageUrl) {
                <img [src]="message().imageUrl" alt="Generated dish" class="mt-3 rounded-lg shadow-md max-w-full h-auto" />
            }
            
            <div class="space-y-4 mt-4 text-left">
                @for (restaurant of p.list; track restaurant.name) {
                    <div class="bg-stone-800/50 p-3 rounded-lg border border-stone-600/50">
                        <h3 class="font-bold text-amber-400 text-lg">{{ restaurant.name }}</h3>
                        <p class="text-stone-300 italic">{{ restaurant.rating }}</p>
                        <p class="text-stone-200 mt-2 text-sm">{{ restaurant.review }}</p>

                        @if (restaurant.mapsUrl) {
                            <div class="mt-3">
                                <a [href]="restaurant.mapsUrl" target="_blank" rel="noopener noreferrer"
                                   class="inline-flex items-center bg-sky-600 hover:bg-sky-700 text-white text-sm font-bold py-1 px-3 rounded-full transition-colors duration-200">
                                    <i class="fa-solid fa-map-location-dot mr-2"></i>
                                    <span>View on Map</span>
                                </a>
                            </div>
                        }
                    </div>
                }
            </div>

            @if (p.sources) {
                <div class="mt-4 pt-3 border-t border-stone-600 text-left text-sm" [innerHTML]="p.sources"></div>
            }
        </div>
    </div>
    } @else {
    <div class="flex justify-center">
        <div class="bg-stone-700 rounded-lg p-3 max-w-[90%] sm:max-w-lg shadow-lg">
            <div class="text-stone-200 whitespace-pre-wrap text-center" [innerHTML]="renderMarkdown(message().text)"></div>
            @if (message().imageUrl) {
                <img [src]="message().imageUrl" alt="Generated dish" class="mt-3 rounded-lg shadow-md max-w-full h-auto" />
            }
        </div>
    </div>
    }
} @else {
<div class="flex justify-center">
    <div class="bg-amber-600 text-white rounded-lg p-3 max-w-[90%] sm:max-w-lg shadow-lg">
        <p class="whitespace-pre-wrap text-center">{{ message().text }}</p>
        @if (message().imageUrl) {
            <img [src]="message().imageUrl" alt="User uploaded dish" class="mt-3 rounded-lg shadow-md max-w-full h-auto" />
        }
    </div>
</div>
}